(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{687:function(e,t,r){"use strict";r.r(t);r(21),r(32);var n=r(23),o=r(199),l=r(514),d=r.n(l),c={middleware:"authenticated",components:{"global-navi":o.a},data:function(){return{show:!1,loading:!0,mainProps:{width:30,block:!1},fieldsOfCommentData:[{key:"content",label:""}],tableData3:[],fieldsOfLikeArticle:[{key:"titleLink",label:"記事タイトル"},{key:"detailButton",label:"詳細"}],userInfo:"",userComment:"",replyContent:"",allLikeArticlesData:[]}},methods:{getMarginLeft:function(e){return 30*Number(e.nestCount)+"px"},setCommentData:function(element){this.$store.commit("persistedParameter/commentDataSet",element)},registerComment:function(){var e=this;this.show=!0,n.a.collection("user_comment").add({user_id_from:this.$store.state.persistedParameter.userIdPersisted,user_id_to:this.userInfo.user_id,comment:this.userComment,createdAt:new Date}).then((function(){alert("コメントの登録完了"),e.show=!1,e.$store.dispatch("persistedParameter/allCommentDataInitAction"),e.$router.go({path:e.$router.currentRoute.path,force:!0})})).catch((function(e){alert(e.message)}))}},created:function(){var e=this;this.$store.dispatch("persistedParameter/allCommentDataInitAction"),n.a.collection("like_articles").get().then((function(t){t.forEach((function(t){var data=d.a.cloneDeep(t.data());data.user_name===e.$store.getters["persistedParameter/getUserData"].user_name&&e.allLikeArticlesData.push(data)}))})).catch((function(e){alert(e.message)}))},mounted:function(){var e=this;this.userInfo=d.a.cloneDeep(this.$store.getters["persistedParameter/getUserData"]);var t=[];n.a.collection("user_comment").get().then((function(r){r.forEach((function(r){d.a.cloneDeep(r.data());var n=d.a.cloneDeep(r.data());n.commentId=r.id,n.isAddition=!1,n.nestCount=null,n.nestArray=[],n.numberForNestArray=0;for(var i=0;i<e.$store.getters["persistedParameter/getAllProfilePersisted"].length;i++)e.$store.getters["persistedParameter/getAllProfilePersisted"][i].user_id===n.user_id_from&&(n.nick_name_from=e.$store.getters["persistedParameter/getAllProfilePersisted"][i].nick_name,n.image_url=e.$store.getters["persistedParameter/getAllProfilePersisted"][i].image_url);t.push(n)})),console.log("DBから取得した全コメント:"),console.log("dataStockArray_2:"),console.log(t);for(var i=0;i<t.length;i++)t[i].createdAt&&(t[i].createdAt=t[i].createdAt.toDate());for(var n=[],o=0;o<t.length;o++)if(void 0===t[o].reply_comment_id&&e.userInfo.user_id===t[o].user_id_to){t[o].isAddition=!0,t[o].nestCount=0;var l=d.a.cloneDeep(t[o]);n.push(l)}n.sort((function(a,b){return a.createdAt-b.createdAt})),console.log("プロフィールユーザ向けの初回コメント（時系列順）:"),console.log("targetDataArray_2:"),console.log(n);for(var c=[],m=0;m<n.length;m++){c.push(n[m]);for(var _=0;_<t.length;_++)if(t[_].reply_comment_id===n[m].commentId){if(!t[_].isAddition){t[_].isAddition=!0,t[_].nestCount=1;var f=d.a.cloneDeep(t[_]);n[m].nestArray.push(f),c.push(f)}for(var v=0;v<t.length;v++)if(t[v].reply_comment_id===t[_].commentId){if(!t[v].isAddition){t[v].isAddition=!0,t[v].nestCount=2;var h=d.a.cloneDeep(t[v]);n[m].nestArray.push(h),c.push(h)}for(var A=0;A<t.length;A++)if(t[A].reply_comment_id===t[v].commentId&&!t[A].isAddition){t[A].isAddition=!0,t[A].nestCount=3;var y=d.a.cloneDeep(t[A]);n[m].nestArray.push(y),c.push(y)}}}}console.log("プロフィールユーザ向けの初回コメントと返信コメント:"),console.log("targetDataArray_2:"),console.log(n),console.log("displayArray_2:"),console.log(c);for(var k=0;k<c.length;k++){var C=String(Number(c[k].createdAt.getMonth())+1),D=c[k].createdAt.getFullYear()+"年"+C+"月"+c[k].createdAt.getDate()+"日"+c[k].createdAt.getHours()+"時"+c[k].createdAt.getMinutes()+"分";c[k].createdAt=D}for(var w=0;w<c.length;w++)c[w].replyButtonFlag=!1;if(e.$store.getters["persistedParameter/getUserIdPersisted"]===e.userInfo.user_id)for(var P=0;P<c.length;P++)0===c[P].nestCount&&P===c.length-1?c[P].replyButtonFlag=!0:0===c[P].nestCount&&0===c[P+1].nestCount&&(c[P].replyButtonFlag=!0),2===c[P].nestCount&&P===c.length-1?c[P].replyButtonFlag=!0:2===c[P].nestCount&&0===c[P+1].nestCount&&(c[P].replyButtonFlag=!0);else for(var j=0;j<c.length;j++)1===c[j].nestCount&&c[j].user_id_to===e.userInfo.user_id&&j===c.length-1?c[j].replyButtonFlag=!0:1===c[j].nestCount&&c[j].user_id_to===e.userInfo.user_id&&0===c[j+1].nestCount&&(c[j].replyButtonFlag=!0);console.log("displayArray_2 after replyButton addition:"),console.log(c);for(var $=0;$<c.length;$++)e.tableData3.push(c[$]);e.loading=!1})).catch((function(e){alert(e.message)}))}},m=r(46),component=Object(m.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-spinner",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],attrs:{small:""}}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}]},[r("h2",[e._v(e._s(e.$store.getters["persistedParameter/getUserData"].nick_name)+"さんのプロフィール")]),e._v(" "),r("b-card",{staticStyle:{"max-width":"540px"},attrs:{"no-body":""}},[r("b-row",[r("b-col",{attrs:{md:"6"}},[r("b-img",{attrs:{src:e.$store.getters["persistedParameter/getUserData"].image_url,alt:""}})],1),e._v(" "),r("b-col",{attrs:{md:"6"}},[r("b-card-body",{attrs:{title:e.$store.getters["persistedParameter/getUserData"].nick_name}},[r("b-card-text",[e._v("\n                "+e._s(e.$store.getters["persistedParameter/getUserData"].self_introduction)+"\n                abcdedffgadfasdfeilsdjfksjfoeilsdfjksjdfif\n                asdfalsfjieasjdlfjalskjdflsjdlfaskdjflsajdlfa\n                asjdfjlasdjflasjdflkjasdlfkjlasdjflasdjflajsdf\n              ")])],1)],1)],1)],1),e._v(" "),r("h2",[e._v("お気に入り記事")]),e._v(" "),r("b-table",{attrs:{items:e.allLikeArticlesData,fields:e.fieldsOfLikeArticle,responsive:"sm"},scopedSlots:e._u([{key:"cell(titleLink)",fn:function(data){return[r("a",{attrs:{href:data.item.url}},[e._v(e._s(data.item.title))])]}},{key:"cell(detailButton)",fn:function(t){return[r("b-button",{staticClass:"mr-2",attrs:{size:"sm"},on:{click:t.toggleDetails}},[e._v("\n            \n              "+e._s(t.detailsShowing?"閉じる":"詳細")+"\n            ")])]}},{key:"row-details",fn:function(t){return[r("b-card",[r("b-row",{staticClass:"mb-2"},[r("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[r("b",[e._v("おすすめする人:")])]),e._v(" "),r("b-col",[e._v(e._s(t.item.recommendation))])],1),e._v(" "),r("b-row",{staticClass:"mb-2"},[r("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[r("b",[e._v("コメント:")])]),e._v(" "),r("b-col",[e._v(e._s(t.item.free_text_area))])],1)],1)]}}])}),e._v(" "),r("h2",[e._v("コメントを残す")]),e._v(" "),r("b-overlay",{attrs:{show:e.show,rounded:"sm"}},[r("b-card",{attrs:{"bg-variant":"light"}},[r("b-form-textarea",{attrs:{id:"textarea",placeholder:"Enter something...",rows:"3","max-rows":"6"},model:{value:e.userComment,callback:function(t){e.userComment=t},expression:"userComment"}}),e._v(" "),r("b-button",{on:{click:e.registerComment}},[e._v("コメントを送信する")])],1)],1),e._v(" "),r("h2",[e._v("コメント一覧")]),e._v(" "),r("b-table",{attrs:{items:e.tableData3,fields:e.fieldsOfCommentData,responsive:"sm"},scopedSlots:e._u([{key:"cell(content)",fn:function(data){return[r("div",{style:{marginLeft:e.getMarginLeft(data.item)}},[r("b-img",e._b({attrs:{src:data.item.image_url}},"b-img",e.mainProps,!1)),e._v(" "),r("span",[e._v(e._s(data.item.nick_name_from))]),e._v(" "),r("p",[e._v(e._s(data.item.comment))]),e._v(" "),r("span",[e._v(e._s(data.item.createdAt))]),e._v(" "),data.item.replyButtonFlag?r("router-link",{attrs:{to:{path:"/"+e.$route.params.username+"/"+data.item.commentId}},nativeOn:{click:function(t){return e.setCommentData(data.item)}}},[e._v("返信する")]):e._e(),e._v(" "),r("p",[e._v("commentId:  "+e._s(data.item.commentId))]),e._v(" "),r("p",[e._v("reply_comment_id:  "+e._s(data.item.reply_comment_id))])],1)]}}])})],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);